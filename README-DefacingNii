#DEFACNG LEVN ANAT .NII

#FIRST TIME ONLY: Creating Anaconda Defacing Environment
conda create --name pydeface
conda activate pydeface
conda install pip
cd ~/Levin/Data/Code/DefacingNii/pydeface-master
pip install pydeface

#The code below will search through the current directory and subdirectories for files ending in 'T1w.nii.gz', execute pydeface on those files, and then remove the appended 'defaced' and replace the original files.

#Navigate to the study's BIDS folder
cd ~/Levin/Data/fMRI/Levin_BIDS_2/sub-####/ses-01/anat

#Subject by subject apply pydeface
pydeface 'sub-####_ses-01_T1w.nii.gz'

##OR

#BATCH Apply pydeface to all anatomical images (@Heuristicwondering - this code still needs to be fixed)
find --name '*T1w.nii.gz' --exec pydeface {} \; done

#Open the defaced files in fsleyes to ensure that they've been successfully defaced and no brain tissues has been erased.

#BATCH Remove '_defaced' and replace original file
for file in *_defaced.nii.gz; do mv "$file" "${file/_defaced.nii.gz/.nii.gz}"; done

OR 

#SUBJECT by subject - Navigate to the anatomical directory of the subject and unzip the .gz, remove '_defaced', and rezip

gunzip 'sub-####_ses-01_T1w_defaced.nii.gz'
mv 'sub-####_ses-01_T1w_defaced.nii' 'sub-####_ses-01_T1w.nii'
gzip 'sub-####_ses-01_T1w.nii'
